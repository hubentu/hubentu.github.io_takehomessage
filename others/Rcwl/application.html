<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 5 Application | Bioinformatics tools and pipelines using R and CWL</title>
  <meta name="description" content="A manual to wrap Bioinformatics tools and workflows with Common Workflow Language using the Rcwl package." />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 5 Application | Bioinformatics tools and pipelines using R and CWL" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A manual to wrap Bioinformatics tools and workflows with Common Workflow Language using the Rcwl package." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 5 Application | Bioinformatics tools and pipelines using R and CWL" />
  
  <meta name="twitter:description" content="A manual to wrap Bioinformatics tools and workflows with Common Workflow Language using the Rcwl package." />
  

<meta name="author" content="Qiang Hu" />
<meta name="author" content="Qian Liu" />


<meta name="date" content="2019-08-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="run-approaches.html">
<link rel="next" href="references.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<script src="libs/d3-3.3.8/d3.min.js"></script>
<script src="libs/dagre-0.4.0/dagre-d3.min.js"></script>
<link href="libs/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet" />
<script src="libs/mermaid-0.3.0/dist/mermaid.slim.min.js"></script>
<link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet" />
<script src="libs/chromatography-0.1/chromatography.js"></script>
<script src="libs/DiagrammeR-binding-1.0.1/DiagrammeR.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Rcwl and Case Study</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#r-package-installation"><i class="fa fa-check"></i><b>0.1</b> R package installation</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#system-requirements"><i class="fa fa-check"></i><b>0.2</b> System requirements</a></li>
<li class="chapter" data-level="0.3" data-path="index.html"><a href="index.html#docker"><i class="fa fa-check"></i><b>0.3</b> Docker</a></li>
<li class="chapter" data-level="0.4" data-path="index.html"><a href="index.html#structure-of-the-book"><i class="fa fa-check"></i><b>0.4</b> Structure of the book</a></li>
<li class="chapter" data-level="0.5" data-path="index.html"><a href="index.html#r-session-information"><i class="fa fa-check"></i><b>0.5</b> R session information</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#common-workflow-language"><i class="fa fa-check"></i><b>1.1</b> Common Workflow Language</a></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#first-example"><i class="fa fa-check"></i><b>1.2</b> First example</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#test-run"><i class="fa fa-check"></i><b>1.3</b> Test run</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="components.html"><a href="components.html"><i class="fa fa-check"></i><b>2</b> Components</a><ul>
<li class="chapter" data-level="2.1" data-path="components.html"><a href="components.html#input-parameters"><i class="fa fa-check"></i><b>2.1</b> Input Parameters</a><ul>
<li class="chapter" data-level="2.1.1" data-path="components.html"><a href="components.html#essential-input-parameters"><i class="fa fa-check"></i><b>2.1.1</b> Essential Input parameters</a></li>
<li class="chapter" data-level="2.1.2" data-path="components.html"><a href="components.html#array-inputs"><i class="fa fa-check"></i><b>2.1.2</b> Array Inputs</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="components.html"><a href="components.html#output-parameters"><i class="fa fa-check"></i><b>2.2</b> Output Parameters</a><ul>
<li class="chapter" data-level="2.2.1" data-path="components.html"><a href="components.html#capturing-output"><i class="fa fa-check"></i><b>2.2.1</b> Capturing Output</a></li>
<li class="chapter" data-level="2.2.2" data-path="components.html"><a href="components.html#array-outputs"><i class="fa fa-check"></i><b>2.2.2</b> Array Outputs</a></li>
<li class="chapter" data-level="2.2.3" data-path="components.html"><a href="components.html#standard-output"><i class="fa fa-check"></i><b>2.2.3</b> Standard output</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="writing-pipeline.html"><a href="writing-pipeline.html"><i class="fa fa-check"></i><b>3</b> Writing Pipeline</a><ul>
<li class="chapter" data-level="3.1" data-path="writing-pipeline.html"><a href="writing-pipeline.html#scattering-pipeline"><i class="fa fa-check"></i><b>3.1</b> Scattering pipeline</a></li>
<li class="chapter" data-level="3.2" data-path="writing-pipeline.html"><a href="writing-pipeline.html#pipeline-plot"><i class="fa fa-check"></i><b>3.2</b> Pipeline plot</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="run-approaches.html"><a href="run-approaches.html"><i class="fa fa-check"></i><b>4</b> Run approaches</a><ul>
<li class="chapter" data-level="4.1" data-path="run-approaches.html"><a href="run-approaches.html#running-tools-in-docker"><i class="fa fa-check"></i><b>4.1</b> Running Tools in Docker</a></li>
<li class="chapter" data-level="4.2" data-path="run-approaches.html"><a href="run-approaches.html#running-tools-in-cluster-server"><i class="fa fa-check"></i><b>4.2</b> Running Tools in Cluster server</a></li>
<li class="chapter" data-level="4.3" data-path="run-approaches.html"><a href="run-approaches.html#web-application"><i class="fa fa-check"></i><b>4.3</b> Web Application</a><ul>
<li class="chapter" data-level="4.3.1" data-path="run-approaches.html"><a href="run-approaches.html#cwlparam-example"><i class="fa fa-check"></i><b>4.3.1</b> cwlParam example</a></li>
<li class="chapter" data-level="4.3.2" data-path="run-approaches.html"><a href="run-approaches.html#cwlparam-to-shiny-app"><i class="fa fa-check"></i><b>4.3.2</b> cwlParam to Shiny App</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="application.html"><a href="application.html"><i class="fa fa-check"></i><b>5</b> Application</a><ul>
<li class="chapter" data-level="5.1" data-path="application.html"><a href="application.html#rcwlpipelines-tools"><i class="fa fa-check"></i><b>5.1</b> RcwlPipelines tools</a><ul>
<li class="chapter" data-level="5.1.1" data-path="application.html"><a href="application.html#rcwl-scripts"><i class="fa fa-check"></i><b>5.1.1</b> Rcwl scripts</a></li>
<li class="chapter" data-level="5.1.2" data-path="application.html"><a href="application.html#build-a-pipeline"><i class="fa fa-check"></i><b>5.1.2</b> Build a pipeline</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="application.html"><a href="application.html#rcwlpipelines-summary"><i class="fa fa-check"></i><b>5.2</b> RcwlPipelines summary</a></li>
<li class="chapter" data-level="5.3" data-path="application.html"><a href="application.html#dnaseq-alignment-pipeline"><i class="fa fa-check"></i><b>5.3</b> DNASeq alignment pipeline</a><ul>
<li class="chapter" data-level="5.3.1" data-path="application.html"><a href="application.html#prepare-data"><i class="fa fa-check"></i><b>5.3.1</b> Prepare data</a></li>
<li class="chapter" data-level="5.3.2" data-path="application.html"><a href="application.html#run-in-cluster"><i class="fa fa-check"></i><b>5.3.2</b> Run in cluster</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="application.html"><a href="application.html#rnaseq-pipeline"><i class="fa fa-check"></i><b>5.4</b> RNASeq pipeline</a><ul>
<li class="chapter" data-level="5.4.1" data-path="application.html"><a href="application.html#prepare-data-1"><i class="fa fa-check"></i><b>5.4.1</b> Prepare data</a></li>
<li class="chapter" data-level="5.4.2" data-path="application.html"><a href="application.html#submit-pipeline-with-sge"><i class="fa fa-check"></i><b>5.4.2</b> Submit pipeline with SGE</a></li>
<li class="chapter" data-level="5.4.3" data-path="application.html"><a href="application.html#summarize-qc"><i class="fa fa-check"></i><b>5.4.3</b> Summarize QC</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="application.html"><a href="application.html#mc3-somatic-variant-calling-pipeline"><i class="fa fa-check"></i><b>5.5</b> MC3 somatic variant calling pipeline</a><ul>
<li class="chapter" data-level="5.5.1" data-path="application.html"><a href="application.html#prepare-data-2"><i class="fa fa-check"></i><b>5.5.1</b> Prepare data</a></li>
<li class="chapter" data-level="5.5.2" data-path="application.html"><a href="application.html#run-mc3-pipeline"><i class="fa fa-check"></i><b>5.5.2</b> Run MC3 pipeline</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="application.html"><a href="application.html#gatk4-germline-variant-calling-pipeline"><i class="fa fa-check"></i><b>5.6</b> GATK4 germline variant calling pipeline</a><ul>
<li class="chapter" data-level="5.6.1" data-path="application.html"><a href="application.html#gatk-alignment"><i class="fa fa-check"></i><b>5.6.1</b> GATK Alignment</a></li>
<li class="chapter" data-level="5.6.2" data-path="application.html"><a href="application.html#haplotypecaller"><i class="fa fa-check"></i><b>5.6.2</b> HaplotypeCaller</a></li>
<li class="chapter" data-level="5.6.3" data-path="application.html"><a href="application.html#joint-discovery"><i class="fa fa-check"></i><b>5.6.3</b> Joint Discovery</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Bioinformatics tools and pipelines using R and CWL</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="application" class="section level1">
<h1><span class="header-section-number">Chapter 5</span> Application</h1>
<div id="rcwlpipelines-tools" class="section level2">
<h2><span class="header-section-number">5.1</span> RcwlPipelines tools</h2>
<div id="rcwl-scripts" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Rcwl scripts</h3>
<p>The R scripts to build the CWL tools and pipelines based on the <code>Rcwl</code>
package are stored in the “src” folder with “tl_” and “pl_” prefix
respectively. The function <code>cwlTools</code> can be used to collect the
available scripts. The <code>cachePath</code> can be your existing cache
directory or a new folder.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" title="1">tools &lt;-<span class="st"> </span><span class="kw">cwlTools</span>(<span class="dt">cachePath =</span> <span class="kw">tempdir</span>())</a>
<a class="sourceLine" id="cb82-2" title="2">tools</a></code></pre></div>
<pre><code>## class: BiocFileCache
## bfccache: /tmp/Rtmp7YFNaP
## bfccount: 55
## For more information see: bfcinfo() or bfcquery()</code></pre>
<p>The full paths can be pulled from the “fpath” column. The scripts can
be viewed to demonstrate how the tools and pipelines were built.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" title="1"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb84-2" title="2"><span class="kw">bfcinfo</span>(tools) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(rname, fpath)</a></code></pre></div>
<pre><code>## # A tibble: 55 x 2
##    rname              fpath                                                
##    &lt;chr&gt;              &lt;chr&gt;                                                
##  1 ApplyBQSR          /home/qhu/workspace/projects/RPipe/RcwlPipelines/ins…
##  2 BaseRecalibrator   /home/qhu/workspace/projects/RPipe/RcwlPipelines/ins…
##  3 bcfview            /home/qhu/workspace/projects/RPipe/RcwlPipelines/ins…
##  4 blastn             /home/qhu/workspace/projects/RPipe/RcwlPipelines/ins…
##  5 bowtie2_build      /home/qhu/workspace/projects/RPipe/RcwlPipelines/ins…
##  6 bowtie2            /home/qhu/workspace/projects/RPipe/RcwlPipelines/ins…
##  7 bwa_index          /home/qhu/workspace/projects/RPipe/RcwlPipelines/ins…
##  8 bwa                /home/qhu/workspace/projects/RPipe/RcwlPipelines/ins…
##  9 CalculateContamin… /home/qhu/workspace/projects/RPipe/RcwlPipelines/ins…
## 10 ColSeqArtifact     /home/qhu/workspace/projects/RPipe/RcwlPipelines/ins…
## # … with 45 more rows</code></pre>
<p>The commands and docker containers from the wrapped tools are included
in the metadata.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" title="1">tls &lt;-<span class="st"> </span><span class="kw">bfcinfo</span>(tools) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Type <span class="op">==</span><span class="st"> &quot;tool&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb86-2" title="2"><span class="st">    </span><span class="kw">select</span>(rname, Command, Container)</a></code></pre></div>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" title="1">knitr<span class="op">::</span><span class="kw">kable</span>(tls)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">rname</th>
<th align="left">Command</th>
<th align="left">Container</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ApplyBQSR</td>
<td align="left">gatk ApplyBQSR</td>
<td align="left">broadinstitute/gatk:4.1.2.0</td>
</tr>
<tr class="even">
<td align="left">BaseRecalibrator</td>
<td align="left">gatk BaseRecalibrator</td>
<td align="left">broadinstitute/gatk:4.1.2.0</td>
</tr>
<tr class="odd">
<td align="left">bcfview</td>
<td align="left">bcftools view</td>
<td align="left">biocontainers/bcftools:v1.5_cv3</td>
</tr>
<tr class="even">
<td align="left">blastn</td>
<td align="left">blastn</td>
<td align="left">biocontainers/blast:v2.2.31_cv2</td>
</tr>
<tr class="odd">
<td align="left">bowtie2_build</td>
<td align="left">bowtie2-build</td>
<td align="left">biocontainers/bowtie2:v2.2.9_cv2</td>
</tr>
<tr class="even">
<td align="left">bowtie2</td>
<td align="left">bowtie2</td>
<td align="left">biocontainers/bowtie2:v2.2.9_cv2</td>
</tr>
<tr class="odd">
<td align="left">bwa_index</td>
<td align="left">bwa index</td>
<td align="left">biocontainers/bwa:v0.7.15_cv4</td>
</tr>
<tr class="even">
<td align="left">bwa</td>
<td align="left">bwa mem</td>
<td align="left">biocontainers/bwa:0.7.15_cv4</td>
</tr>
<tr class="odd">
<td align="left">CalculateContamination</td>
<td align="left">gatk CalculateContamination</td>
<td align="left">broadinstitute/gatk:4.1.2.0</td>
</tr>
<tr class="even">
<td align="left">ColSeqArtifact</td>
<td align="left">gatk CollectSequencingArtifactMetrics</td>
<td align="left">broadinstitute/gatk:4.1.2.0</td>
</tr>
<tr class="odd">
<td align="left">cutadapt</td>
<td align="left">cutadapt</td>
<td align="left">kfdrc/cutadapt</td>
</tr>
<tr class="even">
<td align="left">fastqc</td>
<td align="left">fastqc</td>
<td align="left">hubentu/rcwl-rnaseq</td>
</tr>
<tr class="odd">
<td align="left">featureCounts</td>
<td align="left">featureCounts</td>
<td align="left">hubentu/rcwl-rnaseq</td>
</tr>
<tr class="even">
<td align="left">FilterMutectCalls</td>
<td align="left">gatk FilterMutectCalls</td>
<td align="left">broadinstitute/gatk:4.1.2.0</td>
</tr>
<tr class="odd">
<td align="left">FilterOBias</td>
<td align="left">gatk FilterByOrientationBias</td>
<td align="left">broadinstitute/gatk:4.1.2.0</td>
</tr>
<tr class="even">
<td align="left">Funcotator</td>
<td align="left">gatk Funcotator</td>
<td align="left">broadinstitute/gatk:4.1.2.0</td>
</tr>
<tr class="odd">
<td align="left">geneBody_coverage</td>
<td align="left">geneBody_coverage.py</td>
<td align="left">hubentu/rcwl-rnaseq</td>
</tr>
<tr class="even">
<td align="left">genePredToBed</td>
<td align="left">genePredToBed</td>
<td align="left">hubentu/rcwl-rnaseq</td>
</tr>
<tr class="odd">
<td align="left">GenomicsDB</td>
<td align="left">gatk GenomicsDBImport</td>
<td align="left">broadinstitute/gatk:4.1.2.0</td>
</tr>
<tr class="even">
<td align="left">GetPileupSummaries</td>
<td align="left">gatk GetPileupSummaries</td>
<td align="left">broadinstitute/gatk:4.1.2.0</td>
</tr>
<tr class="odd">
<td align="left">gtfToGenePred</td>
<td align="left">gtfToGenePred</td>
<td align="left">hubentu/rcwl-rnaseq</td>
</tr>
<tr class="even">
<td align="left">hisat2_align</td>
<td align="left">hisat2</td>
<td align="left">biocontainers/hisat2:v2.0.5-1-deb_cv1</td>
</tr>
<tr class="odd">
<td align="left">hisat2_build</td>
<td align="left">hisat2-build</td>
<td align="left">biocontainers/hisat2:v2.0.5-1-deb_cv1</td>
</tr>
<tr class="even">
<td align="left">htseq</td>
<td align="left">htseq-count</td>
<td align="left">genomicpariscentre/htseq</td>
</tr>
<tr class="odd">
<td align="left">makeblastdb</td>
<td align="left">makeblastdb</td>
<td align="left">biocontainers/blast:v2.2.31_cv2</td>
</tr>
<tr class="even">
<td align="left">markdup</td>
<td align="left">picard MarkDuplicates</td>
<td align="left">biocontainers/picard:2.3.0</td>
</tr>
<tr class="odd">
<td align="left">mergeBam</td>
<td align="left">picard MergeSamFiles</td>
<td align="left">biocontainers/picard:2.3.0</td>
</tr>
<tr class="even">
<td align="left">multiqc</td>
<td align="left">multiqc</td>
<td align="left">hubentu/rcwl-rnaseq</td>
</tr>
<tr class="odd">
<td align="left">Mutect2</td>
<td align="left">gatk Mutect2</td>
<td align="left">broadinstitute/gatk:4.1.2.0</td>
</tr>
<tr class="even">
<td align="left">mvOut</td>
<td align="left">Rscript -e args &lt;- commandArgs(TRUE); logFile &lt;- args[1]; log1 &lt;- readLines(logFile); startn &lt;- grep(‘Final Outputs:’, log1)+1; endn &lt;- grep(‘}$’, log1); endn &lt;- endn[endn &gt; startn][1]; logOut &lt;- jsonlite::fromJSON(log1[startn:endn]); logOut &lt;- logOut[lengths(logOut)&gt;0]; dir.create(‘output’, showWarnings = FALSE); lapply(logOut, function(x)file.rename(x, file.path(‘output’, basename(x))))</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">PoN</td>
<td align="left">gatk CreateSomaticPanelOfNormals</td>
<td align="left">broadinstitute/gatk:4.1.2.0</td>
</tr>
<tr class="even">
<td align="left">read_distribution</td>
<td align="left">read_distribution.py</td>
<td align="left">hubentu/rcwl-rnaseq</td>
</tr>
<tr class="odd">
<td align="left">runWDL</td>
<td align="left">java</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">salmon_index</td>
<td align="left">salmon index</td>
<td align="left">combinelab/salmon</td>
</tr>
<tr class="odd">
<td align="left">salmon_quant</td>
<td align="left">salmon quant</td>
<td align="left">combinelab/salmon</td>
</tr>
<tr class="even">
<td align="left">sam2bam</td>
<td align="left">samtools view</td>
<td align="left">biocontainers/samtools:v1.7.0_cv3</td>
</tr>
<tr class="odd">
<td align="left">samtools_flagstat</td>
<td align="left">samtools flagstat</td>
<td align="left">biocontainers/samtools:v1.7.0_cv3</td>
</tr>
<tr class="even">
<td align="left">samtools_index</td>
<td align="left">samtools index</td>
<td align="left">biocontainers/samtools:v1.7.0_cv3</td>
</tr>
<tr class="odd">
<td align="left">samtools_stats</td>
<td align="left">samtools stats</td>
<td align="left">biocontainers/samtools:v1.7.0_cv3</td>
</tr>
<tr class="even">
<td align="left">sortBam</td>
<td align="left">samtools sort</td>
<td align="left">biocontainers/samtools:v1.7.0_cv3</td>
</tr>
<tr class="odd">
<td align="left">STAR</td>
<td align="left">STAR</td>
<td align="left">hubentu/rcwl-rnaseq</td>
</tr>
<tr class="even">
<td align="left">starFusion</td>
<td align="left">/usr/local/src/STAR-Fusion/STAR-Fusion</td>
<td align="left">trinityctat/ctatfusion</td>
</tr>
</tbody>
</table>
</div>
<div id="build-a-pipeline" class="section level3">
<h3><span class="header-section-number">5.1.2</span> Build a pipeline</h3>
<p>We can develop a pipline by utilizing the available tools. For
example, a simple alignment pipelines with mapping and marking
duplicates can be built from the <code>tools</code>.</p>
<p>First, we check whether the required tools (bwa, samtools and picard
markduplicates) are available.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" title="1"><span class="kw">bfcquery</span>(tools, <span class="st">&quot;bwa|sam2bam|sortBam|samtools_index|markdup&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb88-2" title="2"><span class="st">    </span><span class="kw">filter</span>(Type <span class="op">==</span><span class="st"> &quot;tool&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb88-3" title="3"><span class="st">    </span><span class="kw">select</span>(rname, Command, Container)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   rname          Command               Container                        
##   &lt;chr&gt;          &lt;chr&gt;                 &lt;chr&gt;                            
## 1 bwa_index      bwa index             biocontainers/bwa:v0.7.15_cv4    
## 2 bwa            bwa mem               biocontainers/bwa:0.7.15_cv4     
## 3 markdup        picard MarkDuplicates biocontainers/picard:2.3.0       
## 4 sam2bam        samtools view         biocontainers/samtools:v1.7.0_cv3
## 5 samtools_index samtools index        biocontainers/samtools:v1.7.0_cv3
## 6 sortBam        samtools sort         biocontainers/samtools:v1.7.0_cv3</code></pre>
<p>Next, we define the input parameters:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" title="1">p1 &lt;-<span class="st"> </span><span class="kw">InputParam</span>(<span class="dt">id =</span> <span class="st">&quot;threads&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;int&quot;</span>)</a>
<a class="sourceLine" id="cb90-2" title="2">p2 &lt;-<span class="st"> </span><span class="kw">InputParam</span>(<span class="dt">id =</span> <span class="st">&quot;RG&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;string&quot;</span>)</a>
<a class="sourceLine" id="cb90-3" title="3">p3 &lt;-<span class="st"> </span><span class="kw">InputParam</span>(<span class="dt">id =</span> <span class="st">&quot;Ref&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;string&quot;</span>)</a>
<a class="sourceLine" id="cb90-4" title="4">p4 &lt;-<span class="st"> </span><span class="kw">InputParam</span>(<span class="dt">id =</span> <span class="st">&quot;FQ1&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;File&quot;</span>)</a>
<a class="sourceLine" id="cb90-5" title="5">p5 &lt;-<span class="st"> </span><span class="kw">InputParam</span>(<span class="dt">id =</span> <span class="st">&quot;FQ2&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;File?&quot;</span>)</a></code></pre></div>
<p>Then we define the pipeline steps, from raw fastqs to duplicates
marked alignments:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" title="1"><span class="co">## bwa</span></a>
<a class="sourceLine" id="cb91-2" title="2">s1 &lt;-<span class="st"> </span><span class="kw">Step</span>(<span class="dt">id =</span> <span class="st">&quot;bwa&quot;</span>, <span class="dt">run =</span> bwa,</a>
<a class="sourceLine" id="cb91-3" title="3">           <span class="dt">In =</span> <span class="kw">list</span>(<span class="dt">threads =</span> <span class="st">&quot;threads&quot;</span>,</a>
<a class="sourceLine" id="cb91-4" title="4">                     <span class="dt">RG =</span> <span class="st">&quot;RG&quot;</span>,</a>
<a class="sourceLine" id="cb91-5" title="5">                     <span class="dt">Ref =</span> <span class="st">&quot;Ref&quot;</span>,</a>
<a class="sourceLine" id="cb91-6" title="6">                     <span class="dt">FQ1 =</span> <span class="st">&quot;FQ1&quot;</span>,</a>
<a class="sourceLine" id="cb91-7" title="7">                     <span class="dt">FQ2 =</span> <span class="st">&quot;FQ2&quot;</span>))</a>
<a class="sourceLine" id="cb91-8" title="8"><span class="co">## sam to bam</span></a>
<a class="sourceLine" id="cb91-9" title="9">s2 &lt;-<span class="st"> </span><span class="kw">Step</span>(<span class="dt">id =</span> <span class="st">&quot;sam2bam&quot;</span>, <span class="dt">run =</span> sam2bam,</a>
<a class="sourceLine" id="cb91-10" title="10">           <span class="dt">In =</span> <span class="kw">list</span>(<span class="dt">sam =</span> <span class="st">&quot;bwa/sam&quot;</span>))</a>
<a class="sourceLine" id="cb91-11" title="11"><span class="co">## sort bam</span></a>
<a class="sourceLine" id="cb91-12" title="12">s3 &lt;-<span class="st"> </span><span class="kw">Step</span>(<span class="dt">id =</span> <span class="st">&quot;sortBam&quot;</span>, <span class="dt">run =</span> sortBam,</a>
<a class="sourceLine" id="cb91-13" title="13">           <span class="dt">In =</span> <span class="kw">list</span>(<span class="dt">bam =</span> <span class="st">&quot;sam2bam/bam&quot;</span>))</a>
<a class="sourceLine" id="cb91-14" title="14"><span class="co">## mark duplicates</span></a>
<a class="sourceLine" id="cb91-15" title="15">s4 &lt;-<span class="st"> </span><span class="kw">Step</span>(<span class="dt">id =</span> <span class="st">&quot;markdup&quot;</span>, <span class="dt">run =</span> markdup,</a>
<a class="sourceLine" id="cb91-16" title="16">           <span class="dt">In =</span> <span class="kw">list</span>(<span class="dt">ibam =</span> <span class="st">&quot;sortBam/sbam&quot;</span>,</a>
<a class="sourceLine" id="cb91-17" title="17">                     <span class="dt">obam =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb91-18" title="18">                         <span class="dt">valueFrom=</span><span class="st">&quot;$(inputs.ibam.nameroot).mdup.bam&quot;</span>),</a>
<a class="sourceLine" id="cb91-19" title="19">                     <span class="dt">matrix =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb91-20" title="20">                         <span class="dt">valueFrom=</span><span class="st">&quot;$(inputs.ibam.nameroot).markdup.txt&quot;</span>)))</a>
<a class="sourceLine" id="cb91-21" title="21"><span class="co">## index bam</span></a>
<a class="sourceLine" id="cb91-22" title="22">s5 &lt;-<span class="st"> </span><span class="kw">Step</span>(<span class="dt">id =</span> <span class="st">&quot;idxBam&quot;</span>, <span class="dt">run =</span> samtools_index,</a>
<a class="sourceLine" id="cb91-23" title="23">           <span class="dt">In =</span> <span class="kw">list</span>(<span class="dt">bam =</span> <span class="st">&quot;markdup/mBam&quot;</span>))</a></code></pre></div>
<p>Last, we define the outputs and connect the steps to a new pipeline:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" title="1">req1 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">class =</span> <span class="st">&quot;StepInputExpressionRequirement&quot;</span>)</a>
<a class="sourceLine" id="cb92-2" title="2">req2 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">class =</span> <span class="st">&quot;InlineJavascriptRequirement&quot;</span>)</a>
<a class="sourceLine" id="cb92-3" title="3"><span class="co">## outputs</span></a>
<a class="sourceLine" id="cb92-4" title="4">o1 &lt;-<span class="st"> </span><span class="kw">OutputParam</span>(<span class="dt">id =</span> <span class="st">&quot;Bam&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;File&quot;</span>, <span class="dt">outputSource =</span> <span class="st">&quot;markdup/mBam&quot;</span>)</a>
<a class="sourceLine" id="cb92-5" title="5">o2 &lt;-<span class="st"> </span><span class="kw">OutputParam</span>(<span class="dt">id =</span> <span class="st">&quot;Idx&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;File&quot;</span>, <span class="dt">outputSource =</span> <span class="st">&quot;idxBam/idx&quot;</span>)</a>
<a class="sourceLine" id="cb92-6" title="6"><span class="co">## stepParam</span></a>
<a class="sourceLine" id="cb92-7" title="7">Align &lt;-<span class="st"> </span><span class="kw">cwlStepParam</span>(<span class="dt">requirements =</span> <span class="kw">list</span>(req1, req2),</a>
<a class="sourceLine" id="cb92-8" title="8">                      <span class="dt">inputs =</span> <span class="kw">InputParamList</span>(p1, p2, p3, p4, p5),</a>
<a class="sourceLine" id="cb92-9" title="9">                      <span class="dt">outputs =</span> <span class="kw">OutputParamList</span>(o1, o2))</a>
<a class="sourceLine" id="cb92-10" title="10"><span class="co">## build pipeline</span></a>
<a class="sourceLine" id="cb92-11" title="11">Align &lt;-<span class="st"> </span>Align <span class="op">+</span><span class="st"> </span>s1 <span class="op">+</span><span class="st"> </span>s2 <span class="op">+</span><span class="st"> </span>s3 <span class="op">+</span><span class="st"> </span>s4 <span class="op">+</span><span class="st"> </span>s5</a></code></pre></div>
<p>The pipeline is ready for use. We can plot the pipeline with
<code>plotCWL</code> from the <code>Rcwl</code> package.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" title="1"><span class="kw">plotCWL</span>(Align)</a></code></pre></div>
<div id="htmlwidget-96c11ae5fcc278930ac3" style="width:672px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-96c11ae5fcc278930ac3">{"x":{"diagram":"graph TB\nA(threads)-->H{bwa}\nB(RG)-->H{bwa}\nC(Ref)-->H{bwa}\nD(FQ1)-->H{bwa}\nE(FQ2)-->H{bwa}\nH{bwa}-->|sam|I{sam2bam}\nI{sam2bam}-->|bam|J{sortBam}\nJ{sortBam}-->|sbam|K{markdup}\nK{markdup}-->F((Bam))\nF((Bam))-->L{idxBam}\nL{idxBam}-->G((Idx))"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="rcwlpipelines-summary" class="section level2">
<h2><span class="header-section-number">5.2</span> RcwlPipelines summary</h2>
<p>So far we have built 4 major pipelines in this package. Here is a
brief introduction to these 4 pipelines. More pipelines and tools are
expected to be included in the future.</p>
</div>
<div id="dnaseq-alignment-pipeline" class="section level2">
<h2><span class="header-section-number">5.3</span> DNASeq alignment pipeline</h2>
<p>The pipeline can be used to preprocess DNA sequences in fastq
format. It can take paired fastqs and read groups from multiple batches
as input.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" title="1"><span class="kw">inputs</span>(bwaAlignRecal)</a></code></pre></div>
<pre><code>## inputs:
##   outBam (string):  
##   RG (string[]):  
##   threads (int):  
##   Ref (File):  
##   FQ1s (File[]):  
##   FQ2s (File[]):  
##   knowSites:
##     type: array
##     prefix:</code></pre>
<p>The pipeline includes two steps and several jobs will be run in each
step.</p>
<ol style="list-style-type: decimal">
<li><code>bwaAlign</code>: bwa alignment by read groups:</li>
</ol>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" title="1"><span class="kw">runs</span>(<span class="kw">runs</span>(bwaAlignRecal)[[<span class="dv">1</span>]])</a></code></pre></div>
<pre><code>## List of length 4
## names(4): bwa sam2bam sortBam idxBam</code></pre>
<ul>
<li><code>bwa</code>: To align fastqs and read groups to reference genome with <code>bwa</code>.</li>
<li><code>sam2bam</code>: To convert the alignments in “sam” format to “bam”
format with <code>samtools</code>.</li>
<li><code>sortBam</code>: To sort the “bam” file by coordinates with <code>samtools</code>.</li>
<li><code>idxBam</code>: To index “bam” file with <code>samtools</code>.</li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><code>mergeBamDup</code>: To merge by samples and mark duplicates:</li>
</ol>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" title="1"><span class="kw">runs</span>(<span class="kw">runs</span>(bwaAlignRecal)[[<span class="dv">2</span>]])</a></code></pre></div>
<pre><code>## List of length 4
## names(4): mergeBam markdup samtools_index samtools_flagstat</code></pre>
<ul>
<li><code>mergeBam</code>: To merge bam files from multiple batches with <code>picard</code>.</li>
<li><code>markdup</code>: To mark duplicates with <code>picard</code>.</li>
<li><code>samtools_index</code>: To index bam file with <code>samtools</code>.</li>
<li><code>samtools_flagstat</code>: To summarize flags in bam with <code>samtools</code>.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><code>BaseRecal</code>: To apply TCGA
BaseRecalibrator and ApplyBQSR.</li>
</ol>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" title="1"><span class="kw">runs</span>(<span class="kw">runs</span>(bwaAlignRecal)[[<span class="dv">3</span>]])</a></code></pre></div>
<pre><code>## List of length 5
## names(5): BaseRecalibrator ApplyBQSR samtools_index samtools_flagstat samtools_stats</code></pre>
<ul>
<li><code>BaseRecalibrator</code>: To Generates recalibration table for Base
Quality Score Recalibration with <code>gatk BaseRecalibrator</code>.</li>
<li><code>ApplyBQSR</code>: To Apply base quality score recalibration with <code>gatk ApplyBQSR</code>.</li>
<li><code>samtools_index</code>: To index bam file with <code>samtools</code>.</li>
<li><code>samtools_flagstat</code>: To summarize flags in bam with <code>samtools</code>.</li>
<li><code>samtools_stats</code>: To collects statistics from BAM file with
<code>samtools</code>.</li>
</ul>
<p>The final bam files with duplicates marked and base quality
recalibration, bam index, duplicates matrix, and statistics summaries
will be in the output folder.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" title="1"><span class="kw">outputs</span>(bwaAlignRecal)</a></code></pre></div>
<pre><code>## outputs:
## BAM:
##   type: File
##   outputSource: BaseRecal/rcBam
## matrix:
##   type: File
##   outputSource: mergeBamDup/matrix
## flagstat:
##   type: File
##   outputSource: BaseRecal/flagstat
## stats:
##   type: File
##   outputSource: BaseRecal/stats</code></pre>
<p>Here is the short summary and steps plot:</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" title="1"><span class="kw">short</span>(bwaAlignRecal)</a></code></pre></div>
<pre><code>## inputs:
## - outBam
## - RG
## - threads
## - Ref
## - FQ1s
## - FQ2s
## - knowSites
## outputs:
## - BAM
## - matrix
## - flagstat
## - stats
## steps:
## - bwaAlign
## - mergeBamDup
## - BaseRecal</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" title="1"><span class="kw">plotCWL</span>(bwaAlignRecal)</a></code></pre></div>
<div id="htmlwidget-9e3192077ca7fc47eccf" style="width:672px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-9e3192077ca7fc47eccf">{"x":{"diagram":"graph TB\nC(threads)-->L{bwaAlign}\nB(RG)-->L{bwaAlign}\nD(Ref)-->L{bwaAlign}\nE(FQ1s)-->L{bwaAlign}\nF(FQ2s)-->L{bwaAlign}\nL{bwaAlign}-->|Bam|M{mergeBamDup}\nA(outBam)-->M{mergeBamDup}\nM{mergeBamDup}-->I((matrix))\nM{mergeBamDup}-->|Idx|N{BaseRecal}\nD(Ref)-->N{BaseRecal}\nG(knowSites)-->N{BaseRecal}\nA(outBam)-->N{BaseRecal}\nN{BaseRecal}-->H((BAM))\nN{BaseRecal}-->J((flagstat))\nN{BaseRecal}-->K((stats))"},"evals":[],"jsHooks":[]}</script>
<div id="prepare-data" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Prepare data</h3>
<p>Here is a simple example of two samples. The “sample1” have two lanes of sequences and the “sample2” has only one pair of reads. The lists of reads1 <code>fq1</code>, reads2 <code>fq2</code>, read groups and output BAM names are defined in the <code>inputList</code>. The reference genome and number of threads to run the job are defined in the shared options, <code>paramList</code>:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" title="1">fq1 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">sample1 =</span> <span class="kw">list</span>(<span class="st">&quot;apps/DNASeq/data/fq1_1.fq&quot;</span>,</a>
<a class="sourceLine" id="cb107-2" title="2">                           <span class="st">&quot;apps/DNASeq/data/fq2_1.fq&quot;</span>),</a>
<a class="sourceLine" id="cb107-3" title="3">            <span class="dt">sample2 =</span> <span class="kw">list</span>(<span class="st">&quot;apps/DNASeq/data/fq1_1.fq&quot;</span>))</a>
<a class="sourceLine" id="cb107-4" title="4">fq2 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">sample1 =</span> <span class="kw">list</span>(<span class="st">&quot;apps/DNASeq/data/fq1_2.fq&quot;</span>,</a>
<a class="sourceLine" id="cb107-5" title="5">                           <span class="st">&quot;apps/DNASeq/data/fq2_2.fq&quot;</span>),</a>
<a class="sourceLine" id="cb107-6" title="6">            <span class="dt">sample2 =</span> <span class="kw">list</span>(<span class="st">&quot;apps/DNASeq/data/fq1_2.fq&quot;</span>))</a>
<a class="sourceLine" id="cb107-7" title="7">rgs &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">sample1 =</span> <span class="kw">list</span>(<span class="st">&quot;@RG</span><span class="ch">\\</span><span class="st">tID:sample1.1</span><span class="ch">\\</span><span class="st">tPL:Illumina</span><span class="ch">\\</span><span class="st">tSM:sample1&quot;</span>,</a>
<a class="sourceLine" id="cb107-8" title="8">                           <span class="st">&quot;@RG</span><span class="ch">\\</span><span class="st">tID:sample1.2</span><span class="ch">\\</span><span class="st">tPL:Illumina</span><span class="ch">\\</span><span class="st">tSM:sample1&quot;</span>),</a>
<a class="sourceLine" id="cb107-9" title="9">            <span class="dt">sample2 =</span> <span class="kw">list</span>(<span class="st">&quot;@RG</span><span class="ch">\\</span><span class="st">tID:sample2.1</span><span class="ch">\\</span><span class="st">tPL:Illumina</span><span class="ch">\\</span><span class="st">tSM:sample2&quot;</span>))</a>
<a class="sourceLine" id="cb107-10" title="10">samples &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">sample1 =</span> <span class="st">&quot;sample1.bam&quot;</span>, <span class="dt">sample2 =</span> <span class="st">&quot;sample2.bam&quot;</span>)</a>
<a class="sourceLine" id="cb107-11" title="11"></a>
<a class="sourceLine" id="cb107-12" title="12">inputList &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">outBam =</span> samples, <span class="dt">RG =</span> rgs, <span class="dt">FQ1s =</span> fq1, <span class="dt">FQ2s =</span> fq2)</a>
<a class="sourceLine" id="cb107-13" title="13">paramList &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">threads =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb107-14" title="14">                  <span class="dt">Ref =</span> <span class="st">&quot;apps/data/hs37d5.fa&quot;</span>,</a>
<a class="sourceLine" id="cb107-15" title="15">                  <span class="dt">knowSites =</span> <span class="kw">list</span>(<span class="st">&quot;apps/data/dbsnp_138.b37.vcf&quot;</span>,</a>
<a class="sourceLine" id="cb107-16" title="16">                                   <span class="st">&quot;apps/data/Mills_and_1000G_gold_standard.indels.b37.vcf&quot;</span>))</a></code></pre></div>
</div>
<div id="run-in-cluster" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Run in cluster</h3>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" title="1">res &lt;-<span class="st"> </span><span class="kw">runCWLBatch</span>(bwaAlignRecal, <span class="dt">outdir =</span> <span class="st">&quot;apps/DNASeq/output/BAM&quot;</span>,</a>
<a class="sourceLine" id="cb108-2" title="2">                   <span class="dt">inputList =</span> inputList, <span class="dt">paramList =</span> paramList,</a>
<a class="sourceLine" id="cb108-3" title="3">                   <span class="dt">BPPARAM =</span> <span class="kw">BatchtoolsParam</span>(<span class="dt">workers =</span> <span class="dv">2</span>, <span class="dt">cluster =</span> <span class="st">&quot;sge&quot;</span>,</a>
<a class="sourceLine" id="cb108-4" title="4">                                             <span class="dt">template =</span> <span class="st">&quot;/rpcc/bioinformatics/sge_centos7.tmpl&quot;</span>,</a>
<a class="sourceLine" id="cb108-5" title="5">                                             <span class="dt">resources =</span> <span class="kw">list</span>(<span class="dt">jobname=</span><span class="st">&quot;bwa&quot;</span>,</a>
<a class="sourceLine" id="cb108-6" title="6">                                                              <span class="dt">threads =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb108-7" title="7">                                                              <span class="dt">queue =</span> <span class="st">&quot;centos7.q&quot;</span>),</a>
<a class="sourceLine" id="cb108-8" title="8">                                             <span class="dt">log=</span><span class="ot">TRUE</span>, <span class="dt">logdir=</span><span class="st">&quot;.&quot;</span>, <span class="dt">progressbar =</span> T),</a>
<a class="sourceLine" id="cb108-9" title="9">                   <span class="dt">docker =</span> <span class="ot">FALSE</span>, <span class="dt">stderr =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<p>List outputs:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" title="1"><span class="kw">dir</span>(<span class="st">&quot;apps/DNASeq/output/BAM/sample2&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;sample2.bam&quot;          &quot;sample2.bam.bai&quot;      &quot;sample2.flagstat.txt&quot;
## [4] &quot;sample2.markdup.txt&quot;  &quot;sample2.stats.txt&quot;</code></pre>
</div>
</div>
<div id="rnaseq-pipeline" class="section level2">
<h2><span class="header-section-number">5.4</span> RNASeq pipeline</h2>
<p>The pipeline was built with reads quality summary, <code>STAR</code> alignment,
quantification by <code>featureCounts</code> and <code>RSeQC</code> quality control. Here
are the inputs:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb111-1" title="1"><span class="kw">inputs</span>(rnaseq_Sf)</a></code></pre></div>
<pre><code>## inputs:
##   in_seqfiles (File[]):  
##   in_prefix (string):  
##   in_genomeDir (Directory):  
##   in_GTFfile (File):  
##   in_runThreadN (int):  1</code></pre>
<p>The pipeline includes 6 steps:</p>
<ul>
<li><code>fastqc</code>: To run quality summary for raw fastqs with <code>fastqc</code>.</li>
<li><code>STAR</code>: To align fastqs with <code>STAR</code>.</li>
<li><code>samtools_index</code>: To index aligned bam file.</li>
<li><code>samtools_flagstat</code>: To summarize alignment flags.</li>
<li><code>featureCounts</code>: To quantify gene abundances.</li>
<li><code>RSeQC</code>: Several steps included.<br />

<ul>
<li><code>gtfToGenePred</code>: To convert GTF annotation to “genePred” format.</li>
<li><code>genePredToBed</code>: To convert “genePred” annotation to “bed” format.</li>
<li><code>r_distribution</code>: To summarize reads distribution over genome features.</li>
<li><code>gCoverage</code>: To summarize read coverage over gene body.</li>
</ul></li>
</ul>
<p>The outputs and logs from alignment, quantification and QC steps are
collected together into the output folder. A final QC report could be
generated by <code>multiqc</code>, which is also available in the data package.</p>
<p>Here are the short summary and steps plot:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb113-1" title="1"><span class="kw">short</span>(rnaseq_Sf)</a></code></pre></div>
<pre><code>## inputs:
## - in_seqfiles
## - in_prefix
## - in_genomeDir
## - in_GTFfile
## - in_runThreadN
## outputs:
## - out_fastqc
## - out_BAM
## - out_Log
## - out_Count
## - out_idx
## - out_stat
## - out_count
## - out_distribution
## - out_gCovP
## - out_gCovT
## steps:
## - fastqc
## - STAR
## - samtools_index
## - samtools_flagstat
## - featureCounts
## - gtfToGenePred
## - genePredToBed
## - r_distribution
## - gCoverage</code></pre>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" title="1"><span class="kw">plotCWL</span>(rnaseq_Sf)</a></code></pre></div>
<div id="htmlwidget-196c77cc1a20bc7d3dbd" style="width:672px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-196c77cc1a20bc7d3dbd">{"x":{"diagram":"graph TB\nA(in_seqfiles)-->P{fastqc}\nP{fastqc}-->F((out_fastqc))\nB(in_prefix)-->Q{STAR}\nC(in_genomeDir)-->Q{STAR}\nD(in_GTFfile)-->Q{STAR}\nA(in_seqfiles)-->Q{STAR}\nE(in_runThreadN)-->Q{STAR}\nQ{STAR}-->G((out_BAM))\nQ{STAR}-->H((out_Log))\nQ{STAR}-->I((out_Count))\nG((out_BAM))-->R{samtools_index}\nR{samtools_index}-->J((out_idx))\nG((out_BAM))-->S{samtools_flagstat}\nS{samtools_flagstat}-->K((out_stat))\nD(in_GTFfile)-->T{featureCounts}\nG((out_BAM))-->T{featureCounts}\nT{featureCounts}-->L((out_count))\nD(in_GTFfile)-->U{gtfToGenePred}\nU{gtfToGenePred}-->|genePred|V{genePredToBed}\nJ((out_idx))-->W{r_distribution}\nV{genePredToBed}-->|bed|W{r_distribution}\nW{r_distribution}-->M((out_distribution))\nJ((out_idx))-->X{gCoverage}\nV{genePredToBed}-->|bed|X{gCoverage}\nX{gCoverage}-->N((out_gCovP))\nX{gCoverage}-->O((out_gCovT))"},"evals":[],"jsHooks":[]}</script>
<div id="prepare-data-1" class="section level3">
<h3><span class="header-section-number">5.4.1</span> Prepare data</h3>
<p>An RNASeq test data set can be downloaded from <a href="http://genomedata.org/rnaseq-tutorial/HBR_UHR_ERCC_ds_5pc.tar">genomedata</a>, which includes paired-end fastqs for 6 samples.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" title="1"><span class="kw">download.file</span>(<span class="st">&quot;http://genomedata.org/rnaseq-tutorial/HBR_UHR_ERCC_ds_5pc.tar&quot;</span>, <span class="st">&quot;apps/RNASeq/data/HBR_UHR_ERCC_ds_5pc.tar)</span></a>
<a class="sourceLine" id="cb116-2" title="2"><span class="st">untar(&quot;</span>apps<span class="op">/</span>RNASeq<span class="op">/</span>data<span class="op">/</span>HBR_UHR_ERCC_ds_5pc.tar<span class="st">&quot;, exdir = &quot;</span>apps<span class="op">/</span>RNASeq<span class="op">/</span>data<span class="op">/</span><span class="st">&quot;)</span></a></code></pre></div>
<p>The input data must be in a named list, with the same names as the input list of the pipeline. For this pipeline, 5 inputs are required to be set, including <code>in_seqfiles</code>, <code>in_prefix</code>, <code>in_genomeDir</code>, <code>in_GTFfile</code> and <code>in_runThreadN</code>.</p>
<p>There are two different input lists, <code>inputList</code> and <code>paramList</code>. The <code>inputList</code> is used to define the inputs for each sample and will be submitted to different cluster nodes. The <code>paramList</code> is used to define parameters which are shared in all jobs.</p>
<p>Two following inputs should be listed in <code>inputList</code>:</p>
<ul>
<li><p><code>in_seqfiles</code>: A list with the fastq files of each sample in each element. The names of the list are also required to be defined and can be the sample IDs. The length of the list will be the same as the number of samples, thus the list will be defined to <code>inputList</code> and assigned to different nodes for parallel computing.</p></li>
<li><p><code>in_prefix</code> is the same as <code>in_seqfiles</code>, which defines a list of sample IDs.</p></li>
</ul>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" title="1">files &lt;-<span class="st"> </span><span class="kw">normalizePath</span>(<span class="kw">list.files</span>(<span class="st">&quot;apps/RNASeq/data/&quot;</span>, <span class="st">&quot;.gz&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb117-2" title="2">files &lt;-<span class="st"> </span><span class="kw">tapply</span>(files, <span class="kw">substring</span>(<span class="kw">basename</span>(files), <span class="dv">1</span>, <span class="dv">8</span>), as.list)</a>
<a class="sourceLine" id="cb117-3" title="3">inputList &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">in_seqfiles =</span> files,</a>
<a class="sourceLine" id="cb117-4" title="4">                  <span class="dt">in_prefix =</span> <span class="kw">as.list</span>(<span class="kw">names</span>(files)))</a></code></pre></div>
<p>These 3 parameter will be defined in <code>paramList</code>:</p>
<ul>
<li><p><code>in_genomeDir</code>: The reference genome indexes for STAR.</p></li>
<li><p><code>in_GTFfile</code>: The gene annotation file in GTF format.</p></li>
<li><p><code>in_runThreadN</code>: The number of threads to run for each job.</p></li>
</ul>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb118-1" title="1">paramList &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb118-2" title="2">    <span class="dt">in_genomeDir =</span> <span class="st">&quot;apps/data/GRCh38_100/&quot;</span>,</a>
<a class="sourceLine" id="cb118-3" title="3">    <span class="dt">in_GTFfile =</span> <span class="st">&quot;apps/data/gencode.v25.annotation.gtf&quot;</span>,</a>
<a class="sourceLine" id="cb118-4" title="4">    <span class="dt">in_runThreadN =</span> <span class="dv">4</span></a>
<a class="sourceLine" id="cb118-5" title="5">)</a></code></pre></div>
<p>In some cases, we need to modify the default arguments in some steps of a pipeline. For example,</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" title="1"><span class="kw">arguments</span>(rnaseq_Sf, <span class="st">&quot;STAR&quot;</span>)[[<span class="dv">2</span>]] &lt;-<span class="st"> &quot;2&quot;</span></a>
<a class="sourceLine" id="cb119-2" title="2"><span class="kw">head</span>(<span class="kw">arguments</span>(rnaseq_Sf, <span class="st">&quot;STAR&quot;</span>))</a></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;--outFilterMultimapNmax&quot;
## 
## [[2]]
## [1] &quot;2&quot;
## 
## [[3]]
## [1] &quot;--outSAMunmapped&quot;
## 
## [[4]]
## [1] &quot;Within&quot;
## 
## [[5]]
## [1] &quot;--outFilterMismatchNmax&quot;
## 
## [[6]]
## [1] &quot;2&quot;</code></pre>
</div>
<div id="submit-pipeline-with-sge" class="section level3">
<h3><span class="header-section-number">5.4.2</span> Submit pipeline with SGE</h3>
<p>The function <code>runCWLBatch</code> is used to submit the pipeline to cluster server. In addition to defining <code>inputList</code> and <code>paramList</code>, we need to define parallel parameters from the <code>BiocParallel</code> package. Here is an example where we use “sge” to submit the jobs. The “sge” template is a bash script with some predefined parameters for “qsub”. The nodes queue name and number of slots/threads are variables from the template and can be assigned by the <code>resources</code> list.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" title="1">res &lt;-<span class="st"> </span><span class="kw">runCWLBatch</span>(<span class="dt">cwl =</span> rnaseq_Sf, <span class="dt">outdir =</span> <span class="st">&quot;apps/RNASeq/output/&quot;</span>,</a>
<a class="sourceLine" id="cb121-2" title="2">                   <span class="dt">inputList =</span> inputList, <span class="dt">paramList =</span> paramList,</a>
<a class="sourceLine" id="cb121-3" title="3">                   <span class="dt">BPPARAM =</span> <span class="kw">BatchtoolsParam</span>(</a>
<a class="sourceLine" id="cb121-4" title="4">                       <span class="dt">workers =</span> <span class="kw">lengths</span>(inputList)[<span class="dv">1</span>], <span class="dt">cluster =</span> <span class="st">&quot;sge&quot;</span>,</a>
<a class="sourceLine" id="cb121-5" title="5">                       <span class="dt">template =</span> <span class="st">&quot;apps/data/sge_centos7.tmpl&quot;</span>,</a>
<a class="sourceLine" id="cb121-6" title="6">                       <span class="dt">resources =</span> <span class="kw">list</span>(<span class="dt">queue =</span> <span class="st">&quot;centos7.q&quot;</span>,</a>
<a class="sourceLine" id="cb121-7" title="7">                                        <span class="dt">threads =</span> <span class="dv">4</span>)))</a></code></pre></div>
<p>That’s it! The fastqc files of each sample will be submitted to different nodes to run the whole pipeline automatically.</p>
<p>All the results have been collected to output directory of each sample. For example,</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" title="1"><span class="kw">dir</span>(<span class="st">&quot;apps/RNASeq/output/HBR_Rep1&quot;</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;HBR_Rep1_ERCC-Mix2_Build37-ErccTranscripts-chr22.read1_fastqc.zip&quot;
##  [2] &quot;HBR_Rep1_ERCC-Mix2_Build37-ErccTranscripts-chr22.read2_fastqc.zip&quot;
##  [3] &quot;HBR_Rep1Aligned.sortedByCoord.out.bam&quot;                            
##  [4] &quot;HBR_Rep1Aligned.sortedByCoord.out.bam.bai&quot;                        
##  [5] &quot;HBR_Rep1Aligned.sortedByCoord.out.distribution.txt&quot;               
##  [6] &quot;HBR_Rep1Aligned.sortedByCoord.out.featureCounts.txt&quot;              
##  [7] &quot;HBR_Rep1Aligned.sortedByCoord.out.featureCounts.txt.summary&quot;      
##  [8] &quot;HBR_Rep1Aligned.sortedByCoord.out.flagstat.txt&quot;                   
##  [9] &quot;HBR_Rep1Aligned.sortedByCoord.out.geneBodyCoverage.curves.pdf&quot;    
## [10] &quot;HBR_Rep1Aligned.sortedByCoord.out.geneBodyCoverage.txt&quot;           
## [11] &quot;HBR_Rep1Log.final.out&quot;                                            
## [12] &quot;HBR_Rep1ReadsPerGene.out.tab&quot;</code></pre>
</div>
<div id="summarize-qc" class="section level3">
<h3><span class="header-section-number">5.4.3</span> Summarize QC</h3>
<p>The tool “multiqc” can aggregate results from the multiple outputs of the pipeline and generate a single page report, which also was implemented in the <code>RcwlPipelines</code> package:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" title="1">multiqc<span class="op">$</span>dir &lt;-<span class="st"> &quot;apps/RNASeq/output&quot;</span></a>
<a class="sourceLine" id="cb124-2" title="2">multiqc</a></code></pre></div>
<p>We can also run the tool using <code>Rcwl</code> locally with the option <code>docker = TRUE</code>:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" title="1"><span class="kw">runCWL</span>(multiqc, <span class="dt">stderr =</span> <span class="st">&quot;&quot;</span>, <span class="dt">Args =</span> <span class="st">&quot;--preserve-entire-environment&quot;</span>, <span class="dt">docker =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><strong>Here we got the QC report:</strong></p>
<p><a href="https://hubentu.github.io/others/multiqc_report.html" class="uri">https://hubentu.github.io/others/multiqc_report.html</a></p>
</div>
</div>
<div id="mc3-somatic-variant-calling-pipeline" class="section level2">
<h2><span class="header-section-number">5.5</span> MC3 somatic variant calling pipeline</h2>
<p>The Multi-Center Mutation Calling in Multiple Cancers project (MC3) pipeline was developed by TCGA to generate a comprehensive encyclopedia of somatic mutation calls. MC3 works by applying an ensemble of seven mutation-calling algorithms with scoring and artifact filtering. More details can be found in this paper:
<a href="https://www.cell.com/fulltext/S2405-4712(18)30096-6">Scalable Open Science Approach for Mutation Calling of Tumor Exomes Using Multiple Genomic Pipelines</a></p>
<p>The <code>mc3</code> pipeline is available at
<a href="https://github.com/OpenGenomics/mc3" class="uri">https://github.com/OpenGenomics/mc3</a>. All required software have been
deployed in cloud with docker.</p>
<p>The pipeline has been imported and contained in the <code>RcwlPipelines</code>
pacakge, which contains two major steps (markID step was removed):</p>
<ul>
<li><p>Call variants by 7 pipelines</p></li>
<li><p>Merge VCF and convert to MAF</p></li>
</ul>
<p>The steps of the pipeline was built on the CWL files from its github
repository, which were also contained in the package. Thereforce, we
need to load the pipleine by sourcing it from the script.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" title="1"><span class="kw">bfcinfo</span>(tools) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(rname <span class="op">==</span><span class="st"> &quot;mc3&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">pull</span>(rpath) <span class="op">%&gt;%</span><span class="st"> </span>source</a>
<a class="sourceLine" id="cb126-2" title="2"><span class="kw">short</span>(mc3)</a></code></pre></div>
<pre><code>## inputs:
## - tumorID
## - normalID
## - tumor
## - normal
## - bed_file
## - centromere
## - cosmic
## - dbsnp
## - refFasta
## - vepData
## outputs:
## - outmaf
## - outvcf
## steps:
## - call_variants
## - convert</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" title="1"><span class="kw">plotCWL</span>(mc3)</a></code></pre></div>
<div id="htmlwidget-83bd240bdeb30b6b99d5" style="width:672px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-83bd240bdeb30b6b99d5">{"x":{"diagram":"graph TB\nC(tumor)-->M{call_variants}\nD(normal)-->M{call_variants}\nF(centromere)-->M{call_variants}\nE(bed_file)-->M{call_variants}\nG(cosmic)-->M{call_variants}\nH(dbsnp)-->M{call_variants}\nI(refFasta)-->M{call_variants}\nA(tumorID)-->M{call_variants}\nB(normalID)-->M{call_variants}\nB(normalID)-->N{convert}\nA(tumorID)-->N{convert}\nM{call_variants}-->|museVCF|N{convert}\nM{call_variants}-->|mutectVCF|N{convert}\nM{call_variants}-->|somaticsniperVCF|N{convert}\nM{call_variants}-->|varscansVCF|N{convert}\nM{call_variants}-->|varscaniVCF|N{convert}\nM{call_variants}-->|radiaVCF|N{convert}\nM{call_variants}-->|pindelVCF|N{convert}\nM{call_variants}-->|indelocatorVCF|N{convert}\nI(refFasta)-->N{convert}\nJ(vepData)-->N{convert}\nC(tumor)-->N{convert}\nD(normal)-->N{convert}\nN{convert}-->K((outmaf))\nN{convert}-->L((outvcf))"},"evals":[],"jsHooks":[]}</script>
<p>Two steps are included.<br />
1. <code>call_variants</code>: To call variants by 7 pipelines:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" title="1">callVar &lt;-<span class="st"> </span><span class="kw">readCWL</span>(<span class="kw">runs</span>(mc3)<span class="op">$</span>call_variants)</a>
<a class="sourceLine" id="cb129-2" title="2"><span class="kw">plotCWL</span>(callVar)</a></code></pre></div>
<div id="htmlwidget-8f1548269e1685564bcf" style="width:672px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-8f1548269e1685564bcf">{"x":{"diagram":"graph TB\nC(reference)-->S{prep_ref}\nB(normal)-->T{normal_pileup}\nS{prep_ref}-->|prepped_ref|T{normal_pileup}\nA(tumor)-->U{tumor_pileup}\nS{prep_ref}-->|prepped_ref|U{tumor_pileup}\nU{tumor_pileup}-->|output|V{varscan}\nT{normal_pileup}-->|output|V{varscan}\nV{varscan}-->N((varscaniVCF))\nA(tumor)-->W{muse}\nB(normal)-->W{muse}\nS{prep_ref}-->|prepped_ref|W{muse}\nD(dbsnp)-->W{muse}\nH(number_of_procs)-->W{muse}\nA(tumor)-->X{mutect}\nB(normal)-->X{mutect}\nS{prep_ref}-->|prepped_ref|X{mutect}\nE(cosmic)-->X{mutect}\nD(dbsnp)-->X{mutect}\nH(number_of_procs)-->X{mutect}\nX{mutect}-->P((mutectVCF))\nA(tumor)-->Y{radia}\nB(normal)-->Y{radia}\nS{prep_ref}-->|prepped_ref|Y{radia}\nH(number_of_procs)-->Y{radia}\nA(tumor)-->Z{somaticsniper}\nB(normal)-->Z{somaticsniper}\nS{prep_ref}-->|prepped_ref|Z{somaticsniper}\nA(tumor)-->A1{pindel}\nB(normal)-->A1{pindel}\nS{prep_ref}-->|prepped_ref|A1{pindel}\nF(centromere)-->A1{pindel}\nH(number_of_procs)-->A1{pindel}\nA(tumor)-->B2{indelocator}\nB(normal)-->B2{indelocator}\nS{prep_ref}-->|prepped_ref|B2{indelocator}\nG(bed_file)-->B2{indelocator}\nB2{indelocator}-->|mutations|C3{reformat_indelocator}\nY{radia}-->|mutations|D4{fpfilter}\nV{varscan}-->|snp_vcf|D4{fpfilter}\nZ{somaticsniper}-->|mutations|D4{fpfilter}\nW{muse}-->|mutations|D4{fpfilter}\nA1{pindel}-->|somatic_vcf|D4{fpfilter}\nC3{reformat_indelocator}-->|mutations|D4{fpfilter}\nA(tumor)-->D4{fpfilter}\nB(normal)-->D4{fpfilter}\nS{prep_ref}-->|prepped_ref|D4{fpfilter}\nI(tumorID)-->D4{fpfilter}\nJ(normalID)-->D4{fpfilter}\nD4{fpfilter}-->Q((radiaVCF))\nD4{fpfilter}-->L((somaticsniperVCF))\nD4{fpfilter}-->M((varscansVCF))\nD4{fpfilter}-->O((museVCF))\nD4{fpfilter}-->K((pindelVCF))\nD4{fpfilter}-->R((indelocatorVCF))"},"evals":[],"jsHooks":[]}</script>
<ol start="2" style="list-style-type: decimal">
<li><code>covert</code>: To merge VCFs and convert to MAF:</li>
</ol>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" title="1">conv &lt;-<span class="st"> </span><span class="kw">readCWL</span>(<span class="kw">runs</span>(mc3)<span class="op">$</span>convert)</a>
<a class="sourceLine" id="cb130-2" title="2"><span class="kw">plotCWL</span>(conv)</a></code></pre></div>
<div id="htmlwidget-13f07c28b5d361248ccf" style="width:672px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-13f07c28b5d361248ccf">{"x":{"diagram":"graph TB\nC(museVCF)-->W{sort_muse}\nW{sort_muse}-->|output_vcf|X{standardize_muse}\nK(refFasta)-->X{standardize_muse}\nB(tumorID)-->X{standardize_muse}\nA(normalID)-->X{standardize_muse}\nD(mutectVCF)-->Y{sort_mutect}\nY{sort_mutect}-->|output_vcf|Z{standardize_mutect}\nK(refFasta)-->Z{standardize_mutect}\nB(tumorID)-->Z{standardize_mutect}\nA(normalID)-->Z{standardize_mutect}\nE(somaticsniperVCF)-->A1{sort_somaticsniper}\nA1{sort_somaticsniper}-->|output_vcf|B2{standardize_somaticsniper}\nK(refFasta)-->B2{standardize_somaticsniper}\nB(tumorID)-->B2{standardize_somaticsniper}\nA(normalID)-->B2{standardize_somaticsniper}\nF(varscansVCF)-->C3{sort_varscans}\nC3{sort_varscans}-->|output_vcf|D4{standardize_varscans}\nK(refFasta)-->D4{standardize_varscans}\nB(tumorID)-->D4{standardize_varscans}\nA(normalID)-->D4{standardize_varscans}\nG(varscaniVCF)-->E5{sort_varscani}\nE5{sort_varscani}-->|output_vcf|F6{standardize_varscani}\nK(refFasta)-->F6{standardize_varscani}\nB(tumorID)-->F6{standardize_varscani}\nA(normalID)-->F6{standardize_varscani}\nH(radiaVCF)-->G7{sort_radia}\nG7{sort_radia}-->|output_vcf|H8{standardize_radia}\nK(refFasta)-->H8{standardize_radia}\nB(tumorID)-->H8{standardize_radia}\nA(normalID)-->H8{standardize_radia}\nJ(indelocatorVCF)-->I9{sort_indelocator}\nI9{sort_indelocator}-->|output_vcf|J10{standardize_indelocator}\nK(refFasta)-->J10{standardize_indelocator}\nB(tumorID)-->J10{standardize_indelocator}\nA(normalID)-->J10{standardize_indelocator}\nI(pindelVCF)-->K11{sort_pindel}\nK11{sort_pindel}-->|output_vcf|L12{standardize_pindel}\nK(refFasta)-->L12{standardize_pindel}\nB(tumorID)-->L12{standardize_pindel}\nA(normalID)-->L12{standardize_pindel}\nX{standardize_muse}-->|vcf|M13{rehead_vcfs}\nZ{standardize_mutect}-->|vcf|M13{rehead_vcfs}\nB2{standardize_somaticsniper}-->|vcf|M13{rehead_vcfs}\nF6{standardize_varscani}-->|vcf|M13{rehead_vcfs}\nD4{standardize_varscans}-->|vcf|M13{rehead_vcfs}\nH8{standardize_radia}-->|vcf|M13{rehead_vcfs}\nL12{standardize_pindel}-->|vcf|M13{rehead_vcfs}\nJ10{standardize_indelocator}-->|vcf|M13{rehead_vcfs}\nM(tumor_analysis_uuid)-->M13{rehead_vcfs}\nN(tumor_bam_name)-->M13{rehead_vcfs}\nO(tumor_aliquot_uuid)-->M13{rehead_vcfs}\nB(tumorID)-->M13{rehead_vcfs}\nP(normal_analysis_uuid)-->M13{rehead_vcfs}\nQ(normal_bam_name)-->M13{rehead_vcfs}\nR(normal_aliquot_uuid)-->M13{rehead_vcfs}\nA(normalID)-->M13{rehead_vcfs}\nS(platform)-->M13{rehead_vcfs}\nT(center)-->M13{rehead_vcfs}\nM13{rehead_vcfs}-->|reheaded_muse|N14{merge_vcf}\nM13{rehead_vcfs}-->|reheaded_mutect|N14{merge_vcf}\nM13{rehead_vcfs}-->|reheaded_somsniper|N14{merge_vcf}\nM13{rehead_vcfs}-->|reheaded_varscans|N14{merge_vcf}\nM13{rehead_vcfs}-->|reheaded_varscani|N14{merge_vcf}\nM13{rehead_vcfs}-->|reheaded_radia|N14{merge_vcf}\nM13{rehead_vcfs}-->|reheaded_indelocator|N14{merge_vcf}\nM13{rehead_vcfs}-->|reheaded_pindel|N14{merge_vcf}\nN14{merge_vcf}-->|output_vcf|O15{vcf2maf}\nK(refFasta)-->O15{vcf2maf}\nL(vepData)-->O15{vcf2maf}\nB(tumorID)-->O15{vcf2maf}\nA(normalID)-->O15{vcf2maf}\nO15{vcf2maf}-->U((outmaf))\nO15{vcf2maf}-->V((vepvcf))"},"evals":[],"jsHooks":[]}</script>
<p>The merged VCF and converted MAF files will be collected to the output
folder:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" title="1"><span class="kw">outputs</span>(mc3)</a></code></pre></div>
<pre><code>## outputs:
## outmaf:
##   type: File
##   outputSource: convert/outmaf
## outvcf:
##   type: File
##   outputSource: convert/vepvcf</code></pre>
<div id="prepare-data-2" class="section level3">
<h3><span class="header-section-number">5.5.1</span> Prepare data</h3>
<p>Testing somatic mutation data can be download from: <a href="https://github.com/genome/somatic-snv-test-data" class="uri">https://github.com/genome/somatic-snv-test-data</a>.</p>
<ol style="list-style-type: decimal">
<li>Input list <code>inputList</code>.
The tumorID/normalID must be consistent with <code>SM</code> from BAM read group.</li>
</ol>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" title="1">inputList &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">tumorID=</span><span class="kw">list</span>(<span class="dt">test=</span><span class="st">&quot;NA12892&quot;</span>),</a>
<a class="sourceLine" id="cb133-2" title="2">                  <span class="dt">normalID=</span><span class="kw">list</span>(<span class="dt">test=</span><span class="st">&quot;NA12878&quot;</span>),</a>
<a class="sourceLine" id="cb133-3" title="3">                  <span class="dt">tumor=</span><span class="kw">list</span>(<span class="dt">test=</span><span class="st">&quot;apps/DNASeq/data/tumor.bam&quot;</span>),</a>
<a class="sourceLine" id="cb133-4" title="4">                  <span class="dt">normal=</span><span class="kw">list</span>(<span class="dt">test=</span><span class="st">&quot;apps/DNASeq/data/normal.bam&quot;</span>))</a></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Parameter list <code>paramList</code>.</li>
</ol>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" title="1">paramList &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">bed_file=</span><span class="st">&quot;apps/data/mc3/gaf_20111020+broad_wex_1.1_hg19.bed&quot;</span>,</a>
<a class="sourceLine" id="cb134-2" title="2">                  <span class="dt">centromere=</span><span class="st">&quot;apps/data/mc3/centromere_hg19.bed&quot;</span>,</a>
<a class="sourceLine" id="cb134-3" title="3">                  <span class="dt">cosmic=</span><span class="st">&quot;apps/data/mc3/hg19_cosmic_v54_120711.vcf.gz&quot;</span>,</a>
<a class="sourceLine" id="cb134-4" title="4">                  <span class="dt">dbsnp=</span><span class="st">&quot;apps/data/mc3/dbsnp_134_b37.leftAligned.vcf.gz&quot;</span>,</a>
<a class="sourceLine" id="cb134-5" title="5">                  <span class="dt">refFasta=</span><span class="st">&quot;apps/data/human_g1k_v37.fa.gz&quot;</span>,</a>
<a class="sourceLine" id="cb134-6" title="6">                  <span class="dt">vepData=</span><span class="st">&quot;apps/data/.vep/&quot;</span>)</a></code></pre></div>
</div>
<div id="run-mc3-pipeline" class="section level3">
<h3><span class="header-section-number">5.5.2</span> Run MC3 pipeline</h3>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" title="1">res &lt;-<span class="st"> </span><span class="kw">runCWLBatch</span>(mc3, <span class="dt">outdir =</span> <span class="st">&quot;apps/DNASeq/output/mc3&quot;</span>,</a>
<a class="sourceLine" id="cb135-2" title="2">                   <span class="dt">inputList =</span> inputList, <span class="dt">paramList =</span> paramList,</a>
<a class="sourceLine" id="cb135-3" title="3">                   <span class="dt">BPPARAM =</span> <span class="kw">BatchtoolsParam</span>(<span class="dt">workers =</span> <span class="dv">1</span>, <span class="dt">cluster =</span> <span class="st">&quot;sge&quot;</span>,</a>
<a class="sourceLine" id="cb135-4" title="4">                                             <span class="dt">template =</span> <span class="st">&quot;apps/data/sge_centos7.tmpl&quot;</span>,</a>
<a class="sourceLine" id="cb135-5" title="5">                                             <span class="dt">resources =</span> <span class="kw">list</span>(<span class="dt">threads =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb135-6" title="6">                                                              <span class="dt">queue =</span> <span class="st">&quot;centos7.q&quot;</span>)))</a></code></pre></div>
<p>The final VCF was filtered and merged from the outputs of different
callers and annotated by VEP:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" title="1"><span class="kw">dir</span>(<span class="st">&quot;apps/DNASeq/output/mc3/test&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;merged.vep.vcf&quot; &quot;vep.maf&quot;</code></pre>
<p>The merged VCF file was converted to MAF file:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" title="1">vcf &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;apps/DNASeq/output/mc3/test/merged.vep.vcf&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb138-2" title="2"><span class="kw">head</span>(vcf)</a></code></pre></div>
<pre><code>##   V1       V2          V3 V4 V5  V6   V7
## 1 21 10400299           .  A  T 0.0 PASS
## 2 21 10400380           .  C  T   . PASS
## 3 21 10402435   rs2948877  G  A   . PASS
## 4 21 10402715           .  G  A 0.0 PASS
## 5 21 10402795 rs148043841  G  T   . PASS
## 6 21 10402985           .  G GA   . PASS
##                                                                                                                                                                                                V8
## 1                                               CENTERS=RADIA|VARSCANS|MUSE|SOMATICSNIPER;CSQ=T|intergenic_variant|MODIFIER|||||||||||||||rs370695467|1||||1|SNV|1|||||||||||||||||||||||||||||||
## 2                                                          CENTERS=SOMATICSNIPER|RADIA|VARSCANS|MUSE;CSQ=T|intergenic_variant|MODIFIER||||||||||||||||1||||1|SNV|1|||||||||||||||||||||||||||||||
## 3 CENTERS=MUSE|RADIA|VARSCANS|SOMATICSNIPER;CSQ=A|intergenic_variant|MODIFIER|||||||||||||||rs2948877|1||||1|SNV|1||||||||||||||||A:0.3626|A:0.4266|A:0.3228|A:0.3075|A:0.2913|A:0.4346||||||||||
## 4                                                               CENTERS=RADIA|VARSCANS|MUSE;CSQ=A|intergenic_variant|MODIFIER|||||||||||||||rs2948878|1||||1|SNV|1|||||||||||||||||||||||||||||||
## 5                                                             CENTERS=MUSE|RADIA|VARSCANS;CSQ=T|intergenic_variant|MODIFIER|||||||||||||||rs373568457|1||||1|SNV|1|||||||||||||||||||||||||||||||
## 6                                                          CENTERS=VARSCANI*|PINDEL;CSQ=A|intergenic_variant|MODIFIER|||||||||||||||rs375209288|1||||1|insertion|1|||||||||||||||||||||||||||||||
##         V9           V10            V11
## 1 GT:DP:AD 0/0:140:140,0   0/1:92:71,20
## 2 GT:DP:AD 0/0:160:160,0  0/1:117:99,18
## 3 GT:DP:AD 0/0:167:167,0  0/1:124:97,27
## 4 GT:DP:AD 0/0:145:145,0  0/1:117:97,20
## 5 GT:DP:AD 0/0:163:161,2 0/1:127:108,19
## 6 GT:DP:AD   0/0:88:88,0    0/1:82:75,7</code></pre>
</div>
</div>
<div id="gatk4-germline-variant-calling-pipeline" class="section level2">
<h2><span class="header-section-number">5.6</span> GATK4 germline variant calling pipeline</h2>
<p>The GATK 4 best practice pipeline for germline variant calling was
implemented with Workflow Description Language (WDL), which is similar
to cwl and requires
<a href="https://github.com/broadinstitute/cromwell">cromwell</a> to run the
pipeline. The details of the pipeline can be found here:
<a href="https://software.broadinstitute.org/gatk/best-practices/workflow?id=11145" class="uri">https://software.broadinstitute.org/gatk/best-practices/workflow?id=11145</a></p>
<div class="figure">
<img src="https://us.v-cdn.net/5019796/uploads/editor/mz/tzm69d8e2spl.png" alt="Germline short variant discovery (SNPs + Indels)" />
<p class="caption">Germline short variant discovery (SNPs + Indels)</p>
</div>
<p>The germline pipeline include 4 steps in WDL, paired fastq to ubam,
GATK alignment, variant calling by HaplotypeCaller and joint
genotyping. We wrapped the GATK pipeline into 3 steps using <code>Rcwl</code> for
different numbers of computing nodes requirements. The wrapped
pipeline can help to assign inputs to the input JSON templates and
glob results from the <code>cromwell</code> outputs.</p>
<ol style="list-style-type: decimal">
<li><code>GAlign</code> GATK alignment.</li>
</ol>
<p>The fastqs, sample information and customized json files for WDL are
required as inputs. Multiple steps will run in this step, including
<code>bwa</code> alignment, mark duplicates and base quality recalibration. GATK
ready BAM files will be collected into the output directory.</p>
<ol start="2" style="list-style-type: decimal">
<li><code>hapCall</code> HaplotypeCaller.</li>
</ol>
<p>The GATK ready BAM and customized json files are inputs in this
step. The local paths of GATK bundle files are required to be modified
in your json file. A “gVCF” files will be generated.</p>
<ol start="3" style="list-style-type: decimal">
<li><code>jdCall</code> Joint variant discovery</li>
</ol>
<p>This step will combine the “gVCF” files and then call germline
variants in all samples. The paths of the local bundle files are also
required to be changed in the json template file. The final VCF file
of germline variants will be generated.</p>
<div id="gatk-alignment" class="section level3">
<h3><span class="header-section-number">5.6.1</span> GATK Alignment</h3>
<p>We wrapped the steps from raw fastqs to analysis-ready BAM file into <code>GAlign</code> pipeline. Here is the short summary of the pipeline.</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" title="1"><span class="kw">short</span>(GAlign)</a></code></pre></div>
<pre><code>## inputs:
## - fastq1
## - fastq2
## - readGroup
## - sampleName
## - library
## - platunit
## - platform
## - center
## - tmpl1
## - wdl1
## - tmpl2
## - wdl2
## - cromwell
## outputs:
## - bamlog
## - outdir
## steps:
## - fqJson
## - fq2ubam
## - ubam2bamJson
## - align
## - mvOut</code></pre>
<p>For the <code>inputList</code>, we need to assign the fastqs files and read groups for each sample. The inputs can be multiple items separated by comma if there are more than one read groups for each sample. The input templates and WDL scripts can be assigned in the <code>paramList</code>, and the reference and other GATK bundle files in the local json files should be changed accordingly to your local version of files. The path to the <code>cromwell</code> binary file is also required. Here is an example:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" title="1">tmpl1 &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="dt">package=</span><span class="st">&quot;RcwlPipelines&quot;</span>, <span class="st">&quot;GATK4/seq-format-conversion/paired-fastq-to-unmapped-bam.inputs.json&quot;</span>)</a>
<a class="sourceLine" id="cb142-2" title="2">tmpl2 &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="dt">package=</span><span class="st">&quot;RcwlPipelines&quot;</span>, <span class="st">&quot;GATK4/gatk4-data-processing/processing-for-variant-discovery-gatk4.hg38.wgs.inputs.local.json&quot;</span>)</a>
<a class="sourceLine" id="cb142-3" title="3">wdl1 &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="dt">package=</span><span class="st">&quot;RcwlPipelines&quot;</span>, <span class="st">&quot;GATK4/seq-format-conversion/paired-fastq-to-unmapped-bam.wdl&quot;</span>)</a>
<a class="sourceLine" id="cb142-4" title="4">wdl2 &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="dt">package=</span><span class="st">&quot;RcwlPipelines&quot;</span>, <span class="st">&quot;GATK4/gatk4-data-processing/processing-for-variant-discovery-gatk4.wdl&quot;</span>)</a>
<a class="sourceLine" id="cb142-5" title="5"></a>
<a class="sourceLine" id="cb142-6" title="6">inputList &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">fastq1=</span><span class="kw">list</span>(<span class="dt">normal=</span><span class="st">&quot;apps/DNASeq/data/normal_1.fq&quot;</span>,</a>
<a class="sourceLine" id="cb142-7" title="7">                              <span class="dt">tumor=</span><span class="st">&quot;apps/DNASeq/data/tumor_1.fq&quot;</span>),</a>
<a class="sourceLine" id="cb142-8" title="8">                  <span class="dt">fastq2=</span><span class="kw">list</span>(<span class="dt">normal=</span><span class="st">&quot;apps/DNASeq/data/normal_2.fq&quot;</span>,</a>
<a class="sourceLine" id="cb142-9" title="9">                              <span class="dt">tumor=</span><span class="st">&quot;apps/DNASeq/data/tumor_2.fq&quot;</span>),</a>
<a class="sourceLine" id="cb142-10" title="10">                  <span class="dt">readGroup=</span><span class="kw">list</span>(<span class="st">&quot;normal.1&quot;</span>, <span class="st">&quot;tumor.1&quot;</span>),</a>
<a class="sourceLine" id="cb142-11" title="11">                  <span class="dt">sampleName=</span><span class="kw">list</span>(<span class="st">&quot;normal&quot;</span>, <span class="st">&quot;tumor&quot;</span>),</a>
<a class="sourceLine" id="cb142-12" title="12">                  <span class="dt">library=</span><span class="kw">list</span>(<span class="st">&quot;normal&quot;</span>, <span class="st">&quot;tumor&quot;</span>),</a>
<a class="sourceLine" id="cb142-13" title="13">                  <span class="dt">platunit=</span><span class="kw">list</span>(<span class="st">&quot;normal&quot;</span>, <span class="st">&quot;tumor&quot;</span>),</a>
<a class="sourceLine" id="cb142-14" title="14">                  <span class="dt">platform=</span><span class="kw">list</span>(<span class="st">&quot;illumina&quot;</span>, <span class="st">&quot;illumina&quot;</span>),</a>
<a class="sourceLine" id="cb142-15" title="15">                  <span class="dt">center=</span><span class="kw">list</span>(<span class="st">&quot;rpccc&quot;</span>, <span class="st">&quot;rpccc&quot;</span>))</a>
<a class="sourceLine" id="cb142-16" title="16">paramList &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">tmpl1=</span>tmpl1,</a>
<a class="sourceLine" id="cb142-17" title="17">                  <span class="dt">wdl1=</span>wdl1,</a>
<a class="sourceLine" id="cb142-18" title="18">                  <span class="dt">tmpl2=</span>tmpl2,</a>
<a class="sourceLine" id="cb142-19" title="19">                  <span class="dt">wdl2=</span>wdl2,</a>
<a class="sourceLine" id="cb142-20" title="20">                  <span class="dt">cromwell=</span><span class="st">&quot;/software/cromwell-36.jar&quot;</span>)</a>
<a class="sourceLine" id="cb142-21" title="21">r1 &lt;-<span class="st"> </span><span class="kw">runCWLBatch</span>(GAlign, <span class="dt">outdir=</span><span class="st">&quot;apps/DNASeq/output/BAM&quot;</span>, inputList, paramList,</a>
<a class="sourceLine" id="cb142-22" title="22">                  <span class="kw">BatchtoolsParam</span>(<span class="dt">workers =</span> <span class="dv">2</span>, <span class="dt">cluster=</span><span class="st">&quot;sge&quot;</span>,</a>
<a class="sourceLine" id="cb142-23" title="23">                                  <span class="dt">template =</span> <span class="st">&quot;apps/data/sge_centos7.tmpl&quot;</span>,</a>
<a class="sourceLine" id="cb142-24" title="24">                                  <span class="dt">resources =</span> <span class="kw">list</span>(<span class="dt">threads =</span> <span class="dv">16</span>,</a>
<a class="sourceLine" id="cb142-25" title="25">                                                   <span class="dt">queue =</span> <span class="st">&quot;centos7.q&quot;</span>)),</a>
<a class="sourceLine" id="cb142-26" title="26">                  <span class="dt">stderr=</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<p>The outputs were globbed from the <code>cromwell</code> execution folder:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" title="1"><span class="kw">list.files</span>(<span class="st">&quot;apps/DNASeq/output/BAM/normal&quot;</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] &quot;output/normal.hg38.bai&quot;                        
## [2] &quot;output/normal.hg38.bam&quot;                        
## [3] &quot;output/normal.hg38.bam.md5&quot;                    
## [4] &quot;output/normal.hg38.duplicate_metrics&quot;          
## [5] &quot;output/normal.hg38.recal_data.csv&quot;             
## [6] &quot;processing-for-variant-discovery-gatk4.wdl.log&quot;</code></pre>
</div>
<div id="haplotypecaller" class="section level3">
<h3><span class="header-section-number">5.6.2</span> HaplotypeCaller</h3>
<p>This step takes the BAM files as input and each BAM file will be assigned to different computing nodes. The json template file needs to be modified to include the correct GATK bundle paths first.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" title="1">wdl3 &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="dt">package=</span><span class="st">&quot;RcwlPipelines&quot;</span>, <span class="st">&quot;GATK4/gatk4-germline-snps-indels/haplotypecaller-gvcf-gatk4.wdl&quot;</span>)</a>
<a class="sourceLine" id="cb145-2" title="2">tmpl3 &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="dt">package=</span><span class="st">&quot;RcwlPipelines&quot;</span>, <span class="st">&quot;GATK4/gatk4-germline-snps-indels/haplotypecaller-gvcf-gatk4.hg38.inputs.local.json&quot;</span>)</a>
<a class="sourceLine" id="cb145-3" title="3"></a>
<a class="sourceLine" id="cb145-4" title="4">bams &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">normal =</span> <span class="kw">normalizePath</span>(<span class="st">&quot;output/BAM/normal/output/normal.hg38.bam&quot;</span>),</a>
<a class="sourceLine" id="cb145-5" title="5">             <span class="dt">tumor =</span> <span class="kw">normalizePath</span>(<span class="st">&quot;output/BAM/tumor/output/tumor.hg38.bam&quot;</span>))</a>
<a class="sourceLine" id="cb145-6" title="6">inputList &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">bam =</span> bams)</a>
<a class="sourceLine" id="cb145-7" title="7">paramList &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">intervals =</span> <span class="kw">normalizePath</span>(<span class="st">&quot;output/interval.txt&quot;</span>),</a>
<a class="sourceLine" id="cb145-8" title="8">                  <span class="dt">cromwell =</span> <span class="st">&quot;/software/cromwell-36.jar&quot;</span>,</a>
<a class="sourceLine" id="cb145-9" title="9">                  <span class="dt">wdl =</span> wdl3,</a>
<a class="sourceLine" id="cb145-10" title="10">                  <span class="dt">tmpl =</span> tmpl3)</a>
<a class="sourceLine" id="cb145-11" title="11"></a>
<a class="sourceLine" id="cb145-12" title="12">r2 &lt;-<span class="st"> </span><span class="kw">runCWLBatch</span>(hapCall, <span class="dt">outdir=</span><span class="st">&quot;apps/DNASeq/output/GATK&quot;</span>, inputList, paramList,</a>
<a class="sourceLine" id="cb145-13" title="13">                  <span class="kw">BatchtoolsParam</span>(<span class="dt">workers =</span> <span class="dv">2</span>, <span class="dt">cluster=</span><span class="st">&quot;sge&quot;</span>,</a>
<a class="sourceLine" id="cb145-14" title="14">                                  <span class="dt">template =</span> <span class="st">&quot;apps/data/sge_centos7.tmpl&quot;</span>,</a>
<a class="sourceLine" id="cb145-15" title="15">                                  <span class="dt">resources =</span> <span class="kw">list</span>(<span class="dt">threads =</span> <span class="dv">16</span>,</a>
<a class="sourceLine" id="cb145-16" title="16">                                                   <span class="dt">queue =</span> <span class="st">&quot;centos7.q&quot;</span>)),</a>
<a class="sourceLine" id="cb145-17" title="17">                  <span class="dt">stderr=</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<p>Here are the outputs:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" title="1"><span class="kw">list.files</span>(<span class="st">&quot;apps/DNASeq/output/GATK/normal&quot;</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] &quot;haplotypecaller-gvcf-gatk4.wdl.log&quot;
## [2] &quot;output/normal.hg38.g.vcf.gz&quot;       
## [3] &quot;output/normal.hg38.g.vcf.gz.tbi&quot;</code></pre>
</div>
<div id="joint-discovery" class="section level3">
<h3><span class="header-section-number">5.6.3</span> Joint Discovery</h3>
<p>The joint genotyping step will combine the <code>gvcf</code> files and then call variants in all samples, so only one computing node is required. Multiple values or files of the samples will need to be seperated by comma for each input in the <code>inputList</code>. The paths of the local bundle files will also need to be added to the json template file.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" title="1">wdl4 &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="dt">package=</span><span class="st">&quot;RcwlPipelines&quot;</span>, <span class="st">&quot;GATK4/gatk4-germline-snps-indels/joint-discovery-gatk4-local.wdl&quot;</span>)</a>
<a class="sourceLine" id="cb148-2" title="2">tmpl4 &lt;-<span class="st"> </span><span class="kw">system.file</span>(<span class="dt">package=</span><span class="st">&quot;RcwlPipelines&quot;</span>, <span class="st">&quot;GATK4/gatk4-germline-snps-indels/joint-discovery-gatk4-local.hg38.wgs.inputs.json&quot;</span>)</a>
<a class="sourceLine" id="cb148-3" title="3"></a>
<a class="sourceLine" id="cb148-4" title="4">inputList &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">sampleName =</span> <span class="kw">list</span>(<span class="dt">test=</span><span class="st">&quot;normal,tumor&quot;</span>),</a>
<a class="sourceLine" id="cb148-5" title="5">                  <span class="dt">gvcf =</span> <span class="kw">list</span>(<span class="dt">test=</span><span class="st">&quot;apps/DNASeq/output/GATK/normal/output/normal.hg38.g.vcf.gz,apps/DNASeq/output/GATK/tumor/output/tumor.hg38.g.vcf.gz&quot;</span>))</a>
<a class="sourceLine" id="cb148-6" title="6"></a>
<a class="sourceLine" id="cb148-7" title="7">paramList &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">callsetName =</span> <span class="st">&quot;test&quot;</span>,</a>
<a class="sourceLine" id="cb148-8" title="8">                  <span class="dt">intervals =</span> <span class="st">&quot;apps/DNASeq/output/interval.21.interval_list&quot;</span>,</a>
<a class="sourceLine" id="cb148-9" title="9">                  <span class="dt">unpadded_intervals =</span> <span class="st">&quot;apps/DNASeq/output/interval.21.intervals&quot;</span>,</a>
<a class="sourceLine" id="cb148-10" title="10">                  <span class="dt">tmpl =</span> tmpl4,</a>
<a class="sourceLine" id="cb148-11" title="11">                  <span class="dt">cromwell =</span> <span class="st">&quot;/software/cromwell-36.jar&quot;</span>,</a>
<a class="sourceLine" id="cb148-12" title="12">                  <span class="dt">wdl =</span> wdl4)</a>
<a class="sourceLine" id="cb148-13" title="13"></a>
<a class="sourceLine" id="cb148-14" title="14">r3 &lt;-<span class="st"> </span><span class="kw">runCWLBatch</span>(jdCall, <span class="dt">outdir=</span><span class="st">&quot;apps/DNASeq/output/GATK&quot;</span>, inputList, paramList,</a>
<a class="sourceLine" id="cb148-15" title="15">                  <span class="kw">BatchtoolsParam</span>(<span class="dt">workers =</span> <span class="dv">1</span>, <span class="dt">cluster=</span><span class="st">&quot;sge&quot;</span>,</a>
<a class="sourceLine" id="cb148-16" title="16">                                  <span class="dt">template =</span> <span class="st">&quot;apps/sge_centos7.tmpl&quot;</span>,</a>
<a class="sourceLine" id="cb148-17" title="17">                                  <span class="dt">resources =</span> <span class="kw">list</span>(<span class="dt">threads =</span> <span class="dv">16</span>,</a>
<a class="sourceLine" id="cb148-18" title="18">                                                   <span class="dt">queue =</span> <span class="st">&quot;centos7.q&quot;</span>)),</a>
<a class="sourceLine" id="cb148-19" title="19">                  <span class="dt">stderr=</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<p>Here are the final outputs:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" title="1"><span class="kw">list.files</span>(<span class="st">&quot;apps/DNASeq/output/GATK/test&quot;</span>, <span class="dt">recursive =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] &quot;joint-discovery-gatk4-local.wdl.log&quot;        
## [2] &quot;output/out.intervals&quot;                       
## [3] &quot;output/test.variant_calling_detail_metrics&quot; 
## [4] &quot;output/test.variant_calling_summary_metrics&quot;
## [5] &quot;output/test.vcf.gz&quot;                         
## [6] &quot;output/test.vcf.gz.tbi&quot;</code></pre>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="run-approaches.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-application.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["Rcwl-Pipelines.pdf", "Rcwl-Pipelines.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
